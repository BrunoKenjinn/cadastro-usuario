<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Filmes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h1>Cadastro de Filmes</h1>
    <input type="text" id="buscarNome" placeholder="Buscar por nome">
    <button onclick="buscar()">Buscar</button>
    <button onclick="window.location.href='/adicionar.html'">Adicionar Filme</button>
    <hr>
    <h2>Lista de Filmes</h2>
    <table id="filmesTabela">
        <thead>
        <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Diretor</th>
            <th>Ano de Lançamento</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<script>
    const api = "/filmes";

    async function buscar() {
        const nome = document.getElementById("buscarNome").value;
        const resp = await fetch(`${api}/buscar?nome=${encodeURIComponent(nome)}`);
        if (resp.ok) {
            const data = await resp.json();
            preencherTabela(data);
        } else {
            alert("Erro ao buscar filmes!");
        }
    }

    async function carregarFilmes() {
        const resp = await fetch(api);
        if (resp.ok) {
            const data = await resp.json();
            preencherTabela(data);
        } else {
            alert("Erro ao carregar filmes!");
        }
    }

    function preencherTabela(data) {
        const tbody = document.querySelector("#filmesTabela tbody");
        tbody.innerHTML = "";
        data.forEach(filme => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${filme.id}</td>
                <td>${filme.nome}</td>
                <td>${filme.diretor}</td>
                <td>${filme.anoLancamento}</td>
                <td class="actions">
                    <a href="/editar.html?id=${filme.id}">Editar</a>
                    <a href="#" onclick="deletar(${filme.id})">Deletar</a>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    async function deletar(id) {
        if (confirm("Tem certeza que deseja deletar este filme?")) {
            const resp = await fetch(`${api}/${id}`, { method: "DELETE" });
            if (resp.ok) {
                alert("Filme deletado com sucesso!");
                carregarFilmes();
            } else {
                alert("Erro ao deletar filme!");
            }
        }
    }

    window.onload = carregarFilmes;
</script>
</body>
</html>